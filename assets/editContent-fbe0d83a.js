import{Q as _,d as v,r as g,b as o,a as h,l as S,o as m,c as f,j as C,e as i,B as A,L as y,f as n,t as p,p as D,i as I,_ as E}from"./main-5c4f8fb3.js";import{A as j}from"./AppStorage-f0e0e685.js";const O=_.import("blots/block");class d extends O{static create(t){const a=super.create(t);if(t===!0)return a;const e=document.createElement("img");return e.setAttribute("src",t),a.appendChild(e),a}deleteAt(t,a){super.deleteAt(t,a),this.cache={}}static value(t){const{src:a,custom:e}=t.dataset;return{src:a,custom:e}}}d.blotName="imageBlot";d.className="image-uploading";d.tagName="span";_.register({"formats/imageBlot":d});class q{constructor(t,a){this.quill=t,this.options=a,this.range=null,this.placeholderDelta=null,typeof this.options.upload!="function"&&console.warn("[Missing config] upload function that returns a promise is required");var e=this.quill.getModule("toolbar");e&&e.addHandler("image",this.selectLocalImage.bind(this)),this.handleDrop=this.handleDrop.bind(this),this.handlePaste=this.handlePaste.bind(this),this.quill.root.addEventListener("drop",this.handleDrop,!1),this.quill.root.addEventListener("paste",this.handlePaste,!1)}selectLocalImage(){this.quill.focus(),this.range=this.quill.getSelection(),this.fileHolder=document.createElement("input"),this.fileHolder.setAttribute("type","file"),this.fileHolder.setAttribute("accept","image/*"),this.fileHolder.setAttribute("style","visibility:hidden"),this.fileHolder.onchange=this.fileChanged.bind(this),document.body.appendChild(this.fileHolder),this.fileHolder.click(),window.requestAnimationFrame(()=>{document.body.removeChild(this.fileHolder)})}handleDrop(t){if(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length){if(t.stopPropagation(),t.preventDefault(),document.caretRangeFromPoint){const e=document.getSelection(),s=document.caretRangeFromPoint(t.clientX,t.clientY);e&&s&&e.setBaseAndExtent(s.startContainer,s.startOffset,s.startContainer,s.startOffset)}else{const e=document.getSelection(),s=document.caretPositionFromPoint(t.clientX,t.clientY);e&&s&&e.setBaseAndExtent(s.offsetNode,s.offset,s.offsetNode,s.offset)}this.quill.focus(),this.range=this.quill.getSelection();let a=t.dataTransfer.files[0];setTimeout(()=>{this.quill.focus(),this.range=this.quill.getSelection(),this.readAndUploadFile(a)},0)}}handlePaste(t){let a=t.clipboardData||window.clipboardData;if(a&&(a.items||a.files)){let e=a.items||a.files;const s=/^image\/(jpe?g|gif|png|svg|webp)$/i;for(let l=0;l<e.length;l++)if(s.test(e[l].type)){let u=e[l].getAsFile?e[l].getAsFile():e[l];u&&(this.quill.focus(),this.range=this.quill.getSelection(),t.preventDefault(),setTimeout(()=>{this.quill.focus(),this.range=this.quill.getSelection(),this.readAndUploadFile(u)},0))}}}readAndUploadFile(t){let a=!1;const e=new FileReader;e.addEventListener("load",()=>{if(!a){let s=e.result;this.insertBase64Image(s)}},!1),t&&e.readAsDataURL(t),this.options.upload(t).then(s=>{this.insertToEditor(s)},s=>{a=!0,this.removeBase64Image(),console.warn(s)})}fileChanged(){const t=this.fileHolder.files[0];this.readAndUploadFile(t)}insertBase64Image(t){const a=this.range;this.placeholderDelta=this.quill.insertEmbed(a.index,d.blotName,`${t}`,"user")}insertToEditor(t){const a=this.range,e=this.calculatePlaceholderInsertLength();this.quill.deleteText(a.index,e,"user"),this.quill.insertEmbed(a.index,"image",`${t}`,"user"),a.index++,this.quill.setSelection(a,"user")}calculatePlaceholderInsertLength(){return this.placeholderDelta.ops.reduce((t,a)=>(a.hasOwnProperty("insert")&&t++,t),0)}removeBase64Image(){const t=this.range,a=this.calculatePlaceholderInsertLength();this.quill.deleteText(t.index,a,"user")}}window.ImageUploader=q;const w=[[{header:[1,2,3,4,5,6,!1]}],[{size:["small",!1,"large","huge"]}],[{font:[]}],["bold","italic","underline","strike"],[{align:[]}],[{list:"ordered"},{list:"bullet"}],[{color:[]},{background:[]}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],["link","blockquote","image","video","code-block"],["clean"]],P=[{name:"imageUploader",module:q,options:{upload:r=>new Promise((t,a)=>{const e=new FileReader;e.readAsDataURL(r),e.onload=()=>{console.log(e.result),j.uploadContentImage(r.name,e.result).then(s=>{t(s)}).catch(s=>{alert("upload gagal"),a(s)})}})}}],k=v({__name:"QuillEditor",props:{quillContent:{}},setup(r){const t=g(Object(Object.values(Object(Object.entries(Object(o().appCacheData[`${o().activeContent.data.name}`].subContent)[`${o().appCacheData[`${o().activeContent.data.name}`].lastSelectedSubContent}`].page)[Number(h().query.page)-1][1]))[0])),a=g(),e=()=>{t.value.data.ops=a.value.getContents().ops,o().updatePageContent()};return(s,l)=>{const u=S("QuillEditor",!0);return m(),f("div",null,[C(u,{ref_key:"quill",ref:a,toolbar:"quillToolbars"in s?s.quillToolbars:i(w),modules:"quillModules"in s?s.quillModules:i(P),content:s.quillContent.delta,"onUpdate:content":[l[0]||(l[0]=b=>s.quillContent.delta=b),l[1]||(l[1]=b=>e())]},null,8,["toolbar","modules","content"])])}}});const c=r=>(D("data-v-57123803"),r=r(),I(),r),R={key:0,class:"d-flex flex-column gap-4 p-4"},T={class:"container-fluid border-secondary border-bottom py-2"},$={class:"row align-items-center gap-2"},B={class:"col-auto p-1"},F=c(()=>n("div",{class:"text-uppercase small"},[n("span",{class:"badge badge-primary"},[n("u",null," konten ")])],-1)),L={class:"text-uppercase badge badge-secondary"},N={class:"col-auto p-1"},U=c(()=>n("div",{class:"text-uppercase small"},[n("span",{class:"badge badge-primary"},[n("u",null," subkonten ")])],-1)),H={class:"text-uppercase badge badge-secondary"},M={class:"col-auto p-1"},Q=c(()=>n("div",{class:"text-uppercase small"},[n("span",{class:"badge badge-primary"},[n("u",null," halaman ")])],-1)),x={class:"text-uppercase badge badge-secondary"},X={class:"col-auto p-1"},G=c(()=>n("div",{class:"text-uppercase small"},[n("span",{class:"badge badge-primary"},[n("u",null," status ")])],-1)),V={class:"text-uppercase badge badge-secondary"},Y={class:"editor-content d-flex justify-content-center"},z={class:"editor-wrapper col-12 col-md-10 col-lg-8 bg-light rounded-5"},J={key:1,class:"p-4"},K=c(()=>n("span",{class:"loader"},null,-1)),W=[K],Z=v({__name:"editContent",setup(r){const t=g(Object(Object.values(Object(Object.entries(Object(o().appCacheData[`${o().activeContent.data.name}`].subContent)[`${o().appCacheData[`${o().activeContent.data.name}`].lastSelectedSubContent}`].page)[Number(h().query.page)-1][1]))[0])),a=A({updating:!1,updated:!1,html:"<div> </div>",delta:new y(t.value.data)});return(e,s)=>{const l=k;return("AppStore"in e?e.AppStore:i(o))().activeContent.data.name?(m(),f("div",R,[n("div",T,[n("div",$,[n("div",B,[F,n("span",L,p(("AppStore"in e?e.AppStore:i(o))().activeContent.data.name),1)]),n("div",N,[U,n("span",H,p(i(t).name),1)]),n("div",M,[Q,n("span",x,p(`${Number(("useRoute"in e?e.useRoute:i(h))().query.page)} - `+Object(Object.values(Object(Object.entries(Object(("AppStore"in e?e.AppStore:i(o))().appCacheData[`${("AppStore"in e?e.AppStore:i(o))().activeContent.data.name}`].subContent)[`${("AppStore"in e?e.AppStore:i(o))().appCacheData[`${("AppStore"in e?e.AppStore:i(o))().activeContent.data.name}`].lastSelectedSubContent}`].page)[Number(("useRoute"in e?e.useRoute:i(h))().query.page)-1][1]))[0]).name),1)]),n("div",X,[G,n("span",V,p(i(a).updated?"diperbarui":"tidak diperbarui"),1)])])]),n("div",Y,[n("div",z,[C(l,{quillContent:i(a)},null,8,["quillContent"])])])])):(m(),f("div",J,W))}}});const ae=E(Z,[["__scopeId","data-v-57123803"]]);export{ae as default};
//# sourceMappingURL=editContent-fbe0d83a.js.map
